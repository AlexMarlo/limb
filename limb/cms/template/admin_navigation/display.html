<core:wrap file="_cms/page.html" in="content_zone">

  <ar:fetch using='lmbCmsNode' find='by_id_or_path' target='node' first='true' >
    <find:params node_id='{$#request.id}' path='/navigation' />
  </ar:fetch>

  <core:datasource id='node'>

    <core:include file='_cms/node_breadcrumbs.html'>

    <div id="header_block">

        <h1>{$'Navigation'|i18n:'cms'}</h1>

        <div class="header_actions">
          <route_url params="action:create" extra='?popup=1&parent={$id}' title="{$'create'|i18n:'cms'}" class='create'>{$'Create'|i18n:'cms'}</route_url>
        </div>

    </div>

    <div id='content_block'>

     <active_record:fetch using='lmbCmsNode' find='children' target='subfolders' order='priority=ASC'>
      <find:params parent_id='{$id}' />
     </active_record:fetch>

      <core:INCLUDE file='_cms/notify_zone.html'/>

      <form name='list_form' method='post' class="list">

          <table>
          <thead>
           <tr>
             <th class='selector'><core:INCLUDE file='_cms/selector.html'></th>
             <th>#ID</th>
             <th  class='orders'>Порядок</th>
             <th width='100%'>Заголовок</th>
             <th>Ссылка</th>
             <th>Действия</th>
           </tr>
          </thead>

          <list:list id='subfolders'>
          <list:item>
            <tr class='{$Parity}'>
              <td><input type='checkbox' name='ids[]' value='{$id}' runat='client'/></td>
              <td>#{$id}</td>
              <td><input type='text' name='priority[{$id}]' value='{$priority}' class='order' runat='client' size='5'/></td>
              <td><route_url params="id:{$id}">{$title}</route_url></td>
              <td>{$object.url}</td>
              <td class='actions'>
                <route_url params="action:edit,id:{$id}" extra='?popup=1' alt='Редактировать элемент навигации' title='Редактировать элемент навигации'><img src='/shared/cms/images/icon/action/edit.gif' width='16' height='17' alt='Редактировать'/></route_url>
                <route_url params="action:delete" extra='?popup=1&ids[]={$id}' alt='Удалить элемент навигации' title='Удалить элемент навигации'><img src='/shared/cms/images/icon/action/delete.gif' width='14' height='17'  alt='Удалить'/></route_url>
              </td>
            </tr>
          </list:item>
          </list:list>
          </table>

          <div class='list_actions'>
            <route_url_set field='delete_url' params="action:delete" /><input type="button" class='button' value="{$'Delete'|i18n:'cms'}" onclick='Limb.Form.submitPopup(this.form, "{$delete_url}");'/>
            <route_url_set field='save_order_url' params="controller:admin_tree,action:save_priority" /><input type="button" class='button' value="{$'Change order'|i18n:'cms'}" onclick='Limb.Form.submit(this.form, "{$save_order_url}");'/>
          </div>

      </form>

    </div>

  </core:datasource>

</core:wrap>
